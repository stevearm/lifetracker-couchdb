<!DOCTYPE html>
<html>
	<head>
		<title>Lifetracker</title>
		<link rel="stylesheet" href="style/main.css" type="text/css">
	</head>
	<body>
		<div id="menu">
			<span class="menu-item">[ <a href="addEvent.html">Add an event</a> ]</span>
		</div>
		<div id="recent-events"></div>
	</body>
	<script src="/_utils/script/sha1.js"></script>
	<script src="/_utils/script/json2.js"></script>
	<script src="/_utils/script/jquery.js"></script>
	<script src="/_utils/script/jquery.couch.js"></script>
	<script src="vendor/couchapp/jquery.couchLogin.js"></script>
	<script src="vendor/couchapp/jquery.couchProfile.js"></script>
	<script src="vendor/couchapp/md5.js"></script>
	<script src="vendor/couchapp/jquery.mustache.js"></script>

	<!-- templates used by app.js -->
	<script id="recent-events-template" type="text/x-mustache" charset="utf-8">{{#events}}
		<div class="event">
			<div class="event-node-value">
				<span class="event-node-key">when</span>
				{{when}}
			</div>
			<div class="event-node-object">
				<ul>{{#properties}}
					<li><b>{{key}}</b> {{value}}</li>
				{{/properties}}
				</ul>
			</div>
		</div>{{/events}}
	</script>

	<script src="script/app.js"></script>
	<script src="script/helpers/walkNodes.js"></script>
	<script type="text/javascript">
function bootstrap() {
	db.view(design + "/events", {
		descending : "true",
		limit : 10,
		update_seq : true,
		success : function(data) {
			var template = $("#recent-events-template").html();
			var html = $.mustache(template, {
				events : data.rows.map(function(r) {
					var result = {};
					var when = r.value.when.local;
					result.when = when[0]+"-"+when[1]+"-"+when[2]+" @"+fill(when[3])+":"+fill(when[4]);
					delete r.value.when;
					result.properties = [];
					processNode(null, r.value, {
						"array" : function(prefix, node) {
							result.properties.push({"key":prefix, "value":"( "+node.join(", ")+" )"}); 
						},
						"value" : function(prefix, node) { result.properties.push({"key":prefix, "value":node}); }
					});
					result.properties.sort(function(a, b) {
						return a.key.toLowerCase() > b.key.toLowerCase()
					});
					return result;
				})
			});
			$("#recent-events").html(html);
		}
	});
};
	</script>
</html>
